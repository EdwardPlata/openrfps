#!/usr/bin/env coffee

program = require 'commander'
colors = require 'colors'
_ = require 'underscore'

program
  .option('-l, --limit <n>', 'Stop after processing <n> results', parseInt)
  .parse(process.argv)

test = (msg, testFunc) ->
  console.log "#{msg}: ".yellow + (if testFunc() then "OK".green else "Not OK".red)

require('./utils/parse') program, (parsedJson) ->

  return unless parsedJson

  test 'The scraper returns at least one result', ->
    (typeof parsedJson == 'object') && !_.isEmpty(parsedJson)

  test 'an ID attribute is returned', ->
    parsedJson[0] && parsedJson[0]['id']

  test 'the ID attribute is unique', ->
    return false unless parsedJson[0]

    pluckedIds = _.pluck(parsedJson, 'id')
    uniqIds = _.uniq(pluckedIds)

    _.isEqual(pluckedIds, uniqIds)
